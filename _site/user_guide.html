<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Splout SQL User Guide</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- Le styles -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/bootstrap-responsive.min.css" rel="stylesheet">

  <!-- Modified asciidoc css -->
  <link rel="stylesheet" href="./css/xhtml11.css" type="text/css"/>
  <link rel="stylesheet" href="./css/xhtml11-quirks.css" type="text/css"/>

  <script src="js/asciidoc.js"></script>

  <style>

    /* GLOBAL STYLES
    -------------------------------------------------- */
    /* Padding below the footer and lighter body text */

    p, h1, h2, h3, h4, h5 {
    padding-bottom: 5px; /* general breathing for everything */
    }

    body {
    padding-bottom: 40px;
    color: #5a5a5a;
    }

    dt {
    padding-bottom: 5px;
    font-size:20px;
    }

    dl {
    padding-bottom: 15px;
    }

    div#toc a:visited {
    color: #dd4814 !important;
    }

    /* Carousel base class */
    .carousel {
    margin-bottom: 60px;
    }

    .carousel .container {
    position: absolute;
    right: 0;
    bottom: 0;
    left: 0;
    }

    .carousel-control {
    background-color: transparent;
    border: 0;
    font-size: 120px;
    margin-top: 0;
    text-shadow: 0 1px 1px rgba(0,0,0,.4);
    }

    .carousel .item {
    height: 250px;
    }
    .carousel img {
    min-width: 100%;
    height: 250px;
    }

    .carousel-caption {
    background-color: transparent;
    position: static;
    max-width: 550px;
    padding: 0 20px;
    margin-bottom: 100px;
    }
    .carousel-caption h1,
    .carousel-caption .lead {
    margin: 0;
    line-height: 1.25;
    color: #fff;
    text-shadow: 0 1px 1px rgba(0,0,0,.4);
    }

    .carousel-caption .btn {
    margin-top: 10px;
    }

    /* RESPONSIVE CSS
    -------------------------------------------------- */

    @media (max-width: 979px) {
    .container.navbar-wrapper {
    margin-bottom: 0;
    width: auto;
    }
    .navbar-inner {
    border-radius: 0;
    margin: -20px 0;
    }

    .carousel .item {
    height: 300px;
    }
    .carousel img {
    width: auto;
    height: 300px;
    }
    }

    @media (max-width: 767px) {
    .navbar-inner {
    margin: -20px;
    }
    .carousel {
    margin-left: -20px;
    margin-right: -20px;
    }
    .carousel .container {
    }
    .carousel .item {
    height: 300px;
    }
    .carousel img {
    height: 300px;
    }
    .carousel-caption {
    width: 65%;
    padding: 0 70px;
    margin-bottom: 40px;
    }
    .carousel-caption h1 {
    font-size: 30px;
    }
    .carousel-caption .lead,
    .carousel-caption .btn {
    font-size: 18px;
    }
    }
  </style>
</head>

<body style="padding-top: 50px;">

<div class="container">

<div class="navbar navbar-fixed-top navbar-static">
  <div class="navbar-inner">
    <div class="container">
      <a class="brand" href="index.html">Splout SQL</a>

      <div class="nav-collapse">
        <ul class="nav">
          <li><a href="features.html">Features</a></li>
          <li><a href="philosophy.html">Philosophy</a></li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Technical details <b
                class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="architecture.html">Architecture</a></li>
              <li><a href="performance.html">Performance</a></li>
            </ul>
          </li>
          <li class="dropdown">
            <a href="gettingstarted.html" class="dropdown-toggle" data-toggle="dropdown">Getting started
              <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="gettingstarted.html">Installing & running Splout</a></li>
              <li><a href="gettingstarted.html#loading">Loading an example dataset</a></li>
            </ul>
          </li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">User guide <b
                class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="user_guide.html">HTML</a></li>
              <li><a href="user_guide.pdf">Download as PDF</a></li>
            </ul>
          </li>
          <li><a href="faq.html">F.A.Q.</a></li>
        </ul>
        <ul class="nav pull-right">
          <li class="divider-vertical"></li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contributing <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="https://github.com/datasalt/splout-db/">Source code</a></li>
              <li><a href="#">Continuous integration</a></li>
              <li><a href="#">Code quality</a></li>
              <li><a href="https://groups.google.com/forum/#!forum/sploutdb-dev">Developers group</a>
              </li>
            </ul>
          </li>
          <li class="dropdown">
            <a href="about.html" class="dropdown-toggle" data-toggle="dropdown">About <b
                class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="#">License</a></li>
              <li><a href="#">Team</a></li>
              <li><a href="https://groups.google.com/forum/?fromgroups#!forum/sploutdb-users">Users
                group</a></li>
            </ul>
          </li>
        </ul>
      </div>
      <!-- /.nav-collapse -->
    </div>
  </div>
</div>
<!-- /navbar -->

<script>window.onload = function(){asciidoc.footnotes(); asciidoc.toc(2);}</script>
<div id="header">
  <h1>Splout SQL User Guide</h1>

  <div id="toc">
    <div id="toctitle">Table of Contents</div>
    <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p>
    </noscript>
  </div>
</div>
<div id="content">
<h2 id="main">Splout SQL installation</h2>

<div class="sectionbody">
  <div class="paragraph"><p>For running Splout SQL, the underlying system must have the following:</p>
  </div>
  <div class="ulist">
    <ul>
      <li>
        <p>
          Java 1.6 or higher.
        </p>
      </li>
      <li>
        <p>
          <a href="http://hadoop.apache.org/releases.html#Download">Hadoop</a> (versions 0.20.X including
          CDH3 or stable 1.0.4). Splout has been tested to run successfully at least on 1.0.4, 0.20.205
          and CDH3r5.
        </p>
      </li>
    </ul>
  </div>
  <div class="paragraph"><p>You must have HADOOP_HOME environment variable defined in your system. Splout
    will load the libraries from your Hadoop distribution in runtime.</p></div>
  <div class="paragraph"><p>When Splout SQL is <a href="https://github.com/datasalt/splout-db/downloads">downloaded</a>
    and uncompressed in a path - which we will refer to as SPLOUT_HOME - it can be used straight-away.
    However, the <a href="#splout_configuration">Configuration</a> section has to be revised carefully in
    order to adjust everything properly.</p></div>
  <div class="paragraph"><p>Launching the server daemons is as easy as:</p></div>
  <div class="literalblock">
    <div class="content">
<pre><tt>bin/splout-service.sh qnode start
  bin/splout-service.sh dnode start</tt></pre>
    </div>
  </div>
  <div class="admonitionblock">
    <table>
      <tr>
        <td class="icon">
          <div class="title">Tip</div>
        </td>
        <td class="content">
          <div class="title">PID files</div>
          The daemons generate a .pid file from where they are launched.
        </td>
      </tr>
    </table>
  </div>
  <div class="admonitionblock">
    <table>
      <tr>
        <td class="icon">
          <div class="title">Warning</div>
        </td>
        <td class="content">By default, DNode data is written in “dnode-staging” in the same folder where
          it is launched. Please read carefully the <a href="#splout_configuration">Configuration</a>
          section to override this default.
        </td>
      </tr>
    </table>
  </div>
  <div class="paragraph"><p>It is possible to have more than one QNode and more than one DNode in a
    single machine, but for that it is important to understand the <a href="#splout_configuration">Configuration</a>
    and modify a few properties, specially if you launch the services from the same folder.</p></div>
  <div class="paragraph"><p>Logs are stored in logs/ folder from where daemons are launched. <a
      href="http://commons.apache.org/logging/">Commons-logging</a> is used for logging.</p></div>
  <div class="paragraph">
    <div class="title">Splout SQL has been tested to perform correctly under both AMD64 and i386 default
      Amazon AMIs. Splout is compatible with the latest Elastic Map Reduce AMI.
    </div>
    <p>Splout SQL is still beta, so if you find any strange problem or issue please contact us or <a
        href="https://github.com/datasalt/splout-db/issues">raise a bug in Github</a>.</p></div>
  <div class="paragraph"><p><a href="user_guide.html"> &gt; Back to table of contents</a></p></div>
</div>
<h2 id="_the_basics">The basics</h2>

<div class="sectionbody">
  <div class="ulist">
    <div class="title">Splout Terminology</div>
    <ul>
      <li>
        <p>
          Table: A table in Splout can be seen as a standard database table. We will later see how tables
          are defined and what are their particularities.
        </p>
      </li>
      <li>
        <p>
          Tablespace: A tablespace in Splout is a logical union of one or more tables, which are
          co-partitioned in the same way.
        </p>
      </li>
      <li>
        <p>
          Deploy: Splout "deploys" data from a Hadoop-compatible file system such as HDFS or S3, meaning
          that DNodes fetch the appropriate database binary files and save them in their local
          filesystem. When all DNodes have been coordinated to do so, the version of the database that
          they are serving changes atomically to the next one that has been fetched.
        </p>
      </li>
      <li>
        <p>
          Rollback: Splout can "rollback" previous versions if they are kept in the local storage of all
          DNodes. DNodes may keep up to some number of versions for each tablespace, which is a
          configurable property (see the <a href="#splout_configuration">Configuration</a> section for
          that).
        </p>
      </li>
    </ul>
  </div>
  <h3 id="_table_definitions">Table definitions</h3>

  <div style="clear:left"></div>
  <div class="paragraph"><p>A table schema&#8217;s is defined the same way a <a
      href="http://pangool.net/userguide/schemas.html">Pangool Tuple schema</a> is defined. However, the
    data types are adjusted to match <a href="http://www.sqlite.org/datatype3.html">those which are
      compatible with SQLite</a>.
    The following table shows the correspondence between a Pangool type and the underlying SQLite type
    used:</p></div>
  <div class="tableblock">
    <table rules="all"
           width="100%"
           frame="border"
           cellspacing="0" cellpadding="4">
      <caption class="title">Table 1. Correspondence between Pangool types and SQLite types used
      </caption>
      <col width="50%"/>
      <col width="50%"/>
      <tbody>
      <tr>
        <td align="left" valign="top"><p class="table"><strong>Pangool type</strong></p></td>
        <td align="left" valign="top"><p class="table"><strong>SQLite type used</strong></p></td>
      </tr>
      <tr>
        <td align="left" valign="top"><p class="table">INT</p></td>
        <td align="left" valign="top"><p class="table">INTEGER</p></td>
      </tr>
      <tr>
        <td align="left" valign="top"><p class="table">LONG</p></td>
        <td align="left" valign="top"><p class="table">INTEGER</p></td>
      </tr>
      <tr>
        <td align="left" valign="top"><p class="table">DOUBLE</p></td>
        <td align="left" valign="top"><p class="table">REAL</p></td>
      </tr>
      <tr>
        <td align="left" valign="top"><p class="table">FLOAT</p></td>
        <td align="left" valign="top"><p class="table">REAL</p></td>
      </tr>
      <tr>
        <td align="left" valign="top"><p class="table">STRING</p></td>
        <td align="left" valign="top"><p class="table">TEXT</p></td>
      </tr>
      <tr>
        <td align="left" valign="top"><p class="table">BOOLEAN</p></td>
        <td align="left" valign="top"><p class="table">INTEGER (0 is false, 1 is true. SQLite doesn&#8217;t
          support booleans.)</p></td>
      </tr>
      </tbody>
    </table>
  </div>
  <h3 id="_table_types_and_restrictions">Table types and restrictions</h3>

  <div style="clear:left"></div>
  <div class="paragraph"><p>A table is either partitioned or replicated to all partitions. However, a
    tablespace should have at least one partitioned table for the indexer to be able to distribute the
    data among partitions!</p></div>
  <h3 id="_partitioning">Partitioning</h3>

  <div style="clear:left"></div>
  <div class="paragraph"><p>Partitioning is the basis of Splout and it allows it to balance data before
    indexing and deploying it.</p></div>
  <div class="paragraph"><p>The most usual case of partitioning is columnar partitioning, meaning that a
    table is partitioned using one or more columns of its schema.</p></div>
  <div class="paragraph"><p>When more than one table is partitioned in the same tablespace, they must be
    co-partitioned using the same kind of fields. For example, if a tablespace A contains tables A1, A2
    and A3, and A1 and A2
    are partitioned tables and A3 is replicated to all partitions, then if A1 is partitioned by a pair of
    (string, int) columns, then A2 should also be partitioned by a pair of (string, int) columns.</p>
  </div>
  <div class="paragraph">
    <div class="title">TIP: Note that when a table is partitioned by some columns, Splout just
      concatenates the value of those columns as a single string. From that point of view, partitioning
      is a function of a row that returns a string.
    </div>
    <p>Therefore, it is also possible to partition using arbitrary functions, for example a javascript
      function that takes the first two characters of a field. You can check this in the <a
          href="#_hadoop_java_api">Advanced API section</a>.</p></div>
  <h3 id="_partitioning_and_querying">Partitioning and Querying</h3>

  <div style="clear:left"></div>
  <div class="paragraph"><p>Because data is explicitly partitioned, the user must also explicitly provide
    a partitioning key when querying Splout.
    For example, if a dataset has been partitioned by "customer_id", then the user will provide the
    appropriated "customer_id" together with the SQL query when querying Splout through its REST
    interface.</p></div>
  <div class="paragraph"><p><a href="user_guide.html"> &gt; Back to table of contents</a></p></div>
</div>
<h2 id="splout_configuration">Splout SQL Configuration</h2>

<div class="sectionbody">
<div class="paragraph"><p>Splout uses a dual-configuration method, one file for the defaults and one file
  for overriding them. The defaults file is bundled in the JAR and loaded from the classpath. All you
  need to do if you want to override a default is specify it in a new “splout.properties” file. This file
  must be in SPLOUT_HOME or in any other place from where you will launch the daemons or in any location
  of the classpath.</p></div>
<div class="paragraph"><p>This table shows the property names, the explanation of each property and its
  default value. Properties that start with "qnode" affect the configuration of the QNode service.
  Properties that start with "dnode" affect the configuration of the DNode service.
  Properties that start with "fetcher" affect the configuration of the DNode&#8217;s fetcher that is used
  for deploying new data from a remote location (HDFS, S3, etc). Properties that start with "hz" affect
  the behavior of the coordination system used among the cluster, which is based on <a
      href="http://hazelcast.com">Hazelcast</a>.</p></div>
<div class="tableblock">
  <table rules="all"
         width="100%"
         frame="border"
         cellspacing="0" cellpadding="4">
    <caption class="title">Table 2. Splout server configuration</caption>
    <col width="33%"/>
    <col width="33%"/>
    <col width="33%"/>
    <tbody>
    <tr>
      <td align="left" valign="top"><p class="table">qnode.port</p></td>
      <td align="left" valign="top"><p class="table">The port this QNode will run on.</p></td>
      <td align="left" valign="top"><p class="table">4412</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">qnode.port.autoincrement</p></td>
      <td align="left" valign="top"><p class="table">Whether this QNode should find the next available
        port in case "dnode.port" is busy or fail otherwise.</p></td>
      <td align="left" valign="top"><p class="table">true</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">qnode.host</p></td>
      <td align="left" valign="top"><p class="table">The host this QNode will run on. Note: localhost
        will be automatically substituted by the first valid private IP address at runtime.</p></td>
      <td align="left" valign="top"><p class="table">localhost</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">qnode.versions.per.tablespace</p></td>
      <td align="left" valign="top"><p class="table">The number of successfully deployed versions that
        will be kept in the system (per tablespace).</p></td>
      <td align="left" valign="top"><p class="table">10</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">qnode.deploy.seconds.to.check.error</p></td>
      <td align="left" valign="top"><p class="table">The number of seconds to wait before checking each
        time if a DNode has failed or if a timeout has occurred in the middle of a deploy.</p></td>
      <td align="left" valign="top"><p class="table">60</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">dnode.port</p></td>
      <td align="left" valign="top"><p class="table">This DNode&#8217;s port.</p></td>
      <td align="left" valign="top"><p class="table">4422</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">dnode.port.autoincrement</p></td>
      <td align="left" valign="top"><p class="table">Whether this DNode should find the next available
        port in case "dnode.port" is busy or fail otherwise.</p></td>
      <td align="left" valign="top"><p class="table">true</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">dnode.host</p></td>
      <td align="left" valign="top"><p class="table">This DNode&#8217;s host name. Note: localhost will
        be automatically substituted by the first valid private IP address at runtime.</p></td>
      <td align="left" valign="top"><p class="table">localhost</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">dnode.serving.threads</p></td>
      <td align="left" valign="top"><p class="table">How many threads will be allocated for serving
        requests in Thrift&#8217;s ThreadPool Server.</p></td>
      <td align="left" valign="top"><p class="table">64</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">dnode.data.folder</p></td>
      <td align="left" valign="top"><p class="table">The data folder that will be used for storing
        deployed SQL data stores</p></td>
      <td align="left" valign="top"><p class="table">./dnode-staging</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">dnode.pool.cache.seconds</p></td>
      <td align="left" valign="top"><p class="table">The amount of seconds that the DNode will cache SQL
        connection pools. After that time, it will close them. Because the DNode may receive requests for
        different versions in the middle of a deployment, we want to expire connection pools after some
        time (to not cache connection pools that will not be used anymore).</p></td>
      <td align="left" valign="top"><p class="table">3600</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">dnode.pool.cache.n.elements</p></td>
      <td align="left" valign="top"><p class="table">Number of SQL connection pools that will be cached.
        There will be one SQL connection pool for each tablespace, version and partition that this DNode
        serves. So this number must not be smaller than the different numbers of tablespace + version +
        partitions.</p></td>
      <td align="left" valign="top"><p class="table">128</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">dnode.deploy.timeout.seconds</p></td>
      <td align="left" valign="top"><p class="table">The amount of seconds that the DNode will wait
        before canceling a too-long deployment. Default is 10 hours.</p></td>
      <td align="left" valign="top"><p class="table">36000</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">dnode.max.results.per.query</p></td>
      <td align="left" valign="top"><p class="table">A hard limit on the number of results per each SQL
        query that this DNode may send back to QNodes. If the limit is hit, an error will be
        returned.</p></td>
      <td align="left" valign="top"><p class="table">50000</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">dnode.handle.test.commands</p></td>
      <td align="left" valign="top"><p class="table">If set, this DNode will listen for test commands.
        This property is used to activating responsiveness to some commands that are useful for
        integration testing: making a DNode shutdown, etc.</p></td>
      <td align="left" valign="top"><p class="table">false</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">dnode.max.query.time</p></td>
      <td align="left" valign="top"><p class="table">Queries that run for more than this time will be
        interrupted. Must be greater than 1000.</p></td>
      <td align="left" valign="top"><p class="table">15000</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">dnode.slow.query.abs.limit</p></td>
      <td align="left" valign="top"><p class="table">In milliseconds, queries that are slower will be
        logged with a WARNING and registered as "slow queries" for this DNode&#8217;s stats.</p></td>
      <td align="left" valign="top"><p class="table">2500</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">dnode.db.connections.per.pool</p></td>
      <td align="left" valign="top"><p class="table">Size of the connection pool to each partition that
        this DNode services.</p></td>
      <td align="left" valign="top"><p class="table">10</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">fetcher.s3.access.key</p></td>
      <td align="left" valign="top"><p class="table">If using S3 fetching, specify here your AWS
        credentials.</p></td>
      <td align="left" valign="top"><p class="table">(none)</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">fetcher.s3.secret.key</p></td>
      <td align="left" valign="top"><p class="table">If using S3 fetching, specify here your AWS
        credentials.</p></td>
      <td align="left" valign="top"><p class="table">(none)</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">fetcher.temp.dir</p></td>
      <td align="left" valign="top"><p class="table">The local folder that will be used to download new
        deployments.</p></td>
      <td align="left" valign="top"><p class="table">fetcher-tmp</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">fetcher.download.buffer</p></td>
      <td align="left" valign="top"><p class="table">The size in bytes of the in-memory buffer used to
        download files from S3.</p></td>
      <td align="left" valign="top"><p class="table">1048576</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">fetcher.hadoop.fs.name</p></td>
      <td align="left" valign="top"><p class="table">If using Hadoop fetching, the address of the
        NameNode for being able to download data from HDFS.</p></td>
      <td align="left" valign="top"><p class="table">(none)</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">hz.persistent.data.folder</p></td>
      <td align="left" valign="top"><p class="table">Folder to be used to persist Hazelcast state
        information needed to persist current version information. If not present, no information is
        stored, and restarting a cluster will cause it to start without any active tablespace.</p></td>
      <td align="left" valign="top"><p class="table">hz-data</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">hz.port</p></td>
      <td align="left" valign="top"><p class="table">Enable this property if you want your Hazelcast
        service to bind to an specific port. Otherwise the default Hazelcast port is used (5701), and
        auto-incremented if needed.</p></td>
      <td align="left" valign="top"><p class="table">(none)</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">hz.join.method</p></td>
      <td align="left" valign="top"><p class="table">Use this property to configure Hazelcast join in one
        or other way. Possible values: MULTICAST, TCP, AWS</p></td>
      <td align="left" valign="top"><p class="table">multicast</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">hz.multicast.group</p></td>
      <td align="left" valign="top"><p class="table">Uncomment and use this property if method=MULTICAST
        and fine-tuning is needed.</p></td>
      <td align="left" valign="top"><p class="table">(none)</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">hz.multicast.port</p></td>
      <td align="left" valign="top"><p class="table">Uncomment and use this property if method=MULTICAST
        and fine-tuning is needed.</p></td>
      <td align="left" valign="top"><p class="table">(none)</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">hz.tcp.cluster</p></td>
      <td align="left" valign="top"><p class="table">Uncomment and use this property if method=TCP.
        Specify a comma-separated list of host cluster members.</p></td>
      <td align="left" valign="top"><p class="table">(none)</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">hz.aws.security.group</p></td>
      <td align="left" valign="top"><p class="table">Uncomment and use this property if method=AWS and
        only a certain security group is to be examined.</p></td>
      <td align="left" valign="top"><p class="table">(none)</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">hz.aws.key</p></td>
      <td align="left" valign="top"><p class="table">Don&#8217;t forget your AWS credentials if you use
        method=AWS.</p></td>
      <td align="left" valign="top"><p class="table">(none)</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">hz.aws.secret</p></td>
      <td align="left" valign="top"><p class="table">Don&#8217;t forget your AWS credentials if you use
        method=AWS.</p></td>
      <td align="left" valign="top"><p class="table">(none)</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">hz.backup.count</p></td>
      <td align="left" valign="top"><p class="table">Modifies the standard backup count. Affects the
        replication factor of distributed maps.</p></td>
      <td align="left" valign="top"><p class="table">3</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">hz.disable.wait.when.joining</p></td>
      <td align="left" valign="top"><p class="table">Hazelcast waits 5 seconds before joining a member.
        That is good in production because it improves the possibilities of joining several members at
        the same time. But very bad for testing&#8230; This property allows you to disable it for
        testing.</p></td>
      <td align="left" valign="top"><p class="table">false</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">hz.oldest.members.leading.count</p></td>
      <td align="left" valign="top"><p class="table">Number of oldest members leading operations in the
        cluster. Sometimes only these members answer to events, in order to reduce coordination
        traffic.</p></td>
      <td align="left" valign="top"><p class="table">3</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">hz.registry.max.time.to.check.registration</p></td>
      <td align="left" valign="top"><p class="table">Max time, in minutes, to check if the member is
        registered. This check is used to assure eventual consistency in rare cases of network partitions
        where replication was not enough to ensure that no data is lost.</p></td>
      <td align="left" valign="top"><p class="table">5</p></td>
    </tr>
    </tbody>
  </table>
</div>
<h3 id="_typical_distributed_configurations">Typical distributed configurations</h3>

<div style="clear:left"></div>
<div class="paragraph"><p>It is fairly easy to install Splout in a distributed environment. By default,
  Splout will use <a href="http://hazelcast.com">Hazelcast</a> in Multicast mode for finding members, but
  it is possible to configure Splout for explicit TCP/IP or Amazon AWS auto-discovery. Following there
  are some examples of distributed configurations:</p></div>
<div class="tableblock">
  <table rules="all"
         width="100%"
         frame="border"
         cellspacing="0" cellpadding="4">
    <caption class="title">Table 3. Distributed configurations</caption>
    <col width="33%"/>
    <col width="33%"/>
    <col width="33%"/>
    <tbody>
    <tr>
      <td align="left" valign="top"><p class="table">Multicast</p></td>
      <td align="left" valign="top"><p class="table">"hz.join.method=aws", Activated by default.</p></td>
      <td align="left" valign="top"><p class="table">Optionally, "hz.multicast.group",
        "hz.multicast.port" can be used for fine-tuning the configuration.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">TCP/IP</p></td>
      <td align="left" valign="top"><p class="table">"hz.join.method=tcp",
        "hz.tcp.cluster=192.168.1.3,192.168.1.4"</p></td>
      <td align="left" valign="top"><p class="table">Only hosts specified in the comma-separated list
        will be considered for membership.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">AWS</p></td>
      <td align="left" valign="top"><p class="table">"hz.join.method=aws", "hz.aws.key=KEY",
        "hz.aws.secret=SECRET"</p></td>
      <td align="left" valign="top"><p class="table">Using the provided credentials, active hosts in AWS
        will be considered for membership. The list of hosts can be narrowed by specifying a security
        group in " hz.aws.security.group"</p></td>
    </tr>
    </tbody>
  </table>
</div>
<div class="paragraph"><p><a href="user_guide.html"> &gt; Back to table of contents</a></p></div>
</div>
<h2 id="_splout_hadoop_api">Splout-Hadoop API</h2>

<div class="sectionbody">
<div class="paragraph"><p>The Splout-Hadoop API contains the libraries and command-line tools needed for
  indexing and deploying "Tablespaces" to Splout. Splout uses <a href="http://pangool.net">Pangool</a>
  jobs for balancing and creating
  the needed binary files for being able to serve the provided datasets afterwards. Tablespaces can be
  generated according to some partitioning policy specified by the user. The partitioning is
  then leveraged by sampling processes to equitatively distribute data among partitions.</p></div>
<div class="paragraph"><p>The output of these processes is usually a set of binary SQLite ".db" files and
  a partition map which specifies how queries should be routed to these files. Then, a "deployer" process
  is used to distribute these files to the Splout cluster. The "deployer" can also make the same file
  replicate several times in order to have fail-over replication.</p></div>
<h3 id="_command_line_tools">Command line tools</h3>

<div style="clear:left"></div>
<div class="paragraph"><p>The command line tools have been developed to ease the most common use cases.
  They only work with textual (CSV or fixed-width) files at this moment.
  There are two "generator" tools that are responsible for launching a Hadoop process that will balance
  and index the input files,
  and there is one "deployer" tool that is able to deploy the result of any of the generators to an alive
  Splout cluster.</p></div>
<h4 id="_simple_generator">Simple generator</h4>

<div class="paragraph"><p>The "Simple generator" allows us to seamlessly index and deploy a single
  tablespace made up by a single table, which is a very common use case.
  By invoking the tool with no parameters we obtain an explanation of all possible parameters. We will
  see a few examples of how to use this tool:</p></div>
<div class="paragraph"><p>The following line generates the structures needed for deploying a tablespace
  called "customers" containing a table named "customers" whose schema is made up by an integer
  "customer_id" field, a "name" string and an integer "age". The file is present in input folder
  "my-input", will be partitioned in 12 partitions and the binary resultant files will be saved in
  "my-output". The partitioning policy is a columnar partitioning based on the column "customer_id".</p>
</div>
<div class="literalblock">
  <div class="content">
    <pre><tt>hadoop jar splout-hadoop-*-hadoop.jar simple-generate -i my-input -o my-output -pby
      customer_id -p 12 -s "customer_id:int,name:string,age:int" -t customers -tb customers</tt></pre>
  </div>
</div>
<div class="admonitionblock">
  <table>
    <tr>
      <td class="icon">
        <div class="title">Tip</div>
      </td>
      <td class="content">
        <div class="title">Default text format</div>
        The default text format, when not specified, is a tabulated file with no quotes, no escaping, no
        header and no other active advanced parsing option.
      </td>
    </tr>
  </table>
</div>
<div class="paragraph"><p>The following line generates the structures for the same tablespace, but
  specifying a custom CSV format which is comma-separated, escaped by character "\", uses strict quotes
  (""), has a header line and may contain a sequence of characters which has to be interpreted as null:
  "\N".</p></div>
<div class="literalblock">
  <div class="content">
    <pre><tt>hadoop jar splout-hadoop-*-hadoop.jar simple-generate --separator , --escape \\ --quotes
      \"\"\" --nullstring \\N -i my-input -o my-output -pby customer_id -p 12 -s
      "customer_id:int,name:string,age:int" -t customers -tb customers</tt></pre>
  </div>
</div>
<div class="admonitionblock">
  <table>
    <tr>
      <td class="icon">
        <div class="title">Warning</div>
      </td>
      <td class="content">Notice how we needed to escape backslashes when passing them through
        command-line parameters.
      </td>
    </tr>
  </table>
</div>
<div class="paragraph"><p>Strict quotes means that any field which is not quoted will be considered as
  null. When a field can&#8217;t be parsed to its expected format, it is returned as null. For example,
  an empty integer field will be considered null.</p></div>
<div class="admonitionblock">
  <table>
    <tr>
      <td class="icon">
        <div class="title">Tip</div>
      </td>
      <td class="content">
        <div class="title">Fixed-width textual format</div>
        Splout can also use fixed-width text files. For that, you can use the argument
        "--fixedwidthfields". When used, you must provide a comma-separated list of numbers. These
        numbers will be interpreted by pairs, as [beginning, end] inclusive position offsets. For
        example: "0,3,5,7" means there are two fields, the first one of 4 characters at offsets [0, 3]
        and the second one of 3 characters at offsets [5, 7].
      </td>
    </tr>
  </table>
</div>
<h4 id="_generator">Generator</h4>

<div class="paragraph"><p>The "generator" is a simpler command-line which only accepts a JSON file. This
  JSON file will contain the specification of the tablespace or tablespaces to generate. In this case,
  tablespace specs can be as complex as desired, containing multiple tables if needed. You can also
  provide more than one JSON tablespace file to generate them together. Following we will show an example
  tablespace JSON file:</p></div>
<div class="literalblock">
  <div class="content">
<pre><tt>{
  "name": "meteo",
  "nPartitions": 16,
  "partitionedTables": [{
  "name": "meteo",
  "schema": "station:string,date:string,metric:string,measure:int",
  "partitionFields": "station",
  "tableInputs": [{
  "inputSpecs": {
  "separatorChar": ","
  },
  "paths": [
  "small.csv"
  ]
  }]
  }]
  }</tt></pre>
  </div>
</div>
<div class="paragraph"><p>Following we will show the full schema of the JSON object (<a
    href="#JSONTablespaceDefinition">JSONTablespaceDefinition</a>) that can be passed through this file:
</p></div>
<div class="tableblock" id="JSONTablespaceDefinition">
  <table rules="all"
         width="100%"
         frame="border"
         cellspacing="0" cellpadding="4">
    <caption class="title">Table 4. JSONTablespaceDefinition spec</caption>
    <col width="33%"/>
    <col width="33%"/>
    <col width="33%"/>
    <tbody>
    <tr>
      <td align="left" valign="top"><p class="table"><strong>Property</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Type</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Explanation</strong></p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">name</p></td>
      <td align="left" valign="top"><p class="table">string</p></td>
      <td align="left" valign="top"><p class="table">The name of the tablespace.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">nPartitions</p></td>
      <td align="left" valign="top"><p class="table">integer</p></td>
      <td align="left" valign="top"><p class="table">The number of partitions to generate.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">partitionedTables</p></td>
      <td align="left" valign="top"><p class="table">array of <a href="#JSONTableDefinition">JSONTableDefinition</a>
      </p></td>
      <td align="left" valign="top"><p class="table">The partitioned tables of this tablespace. There
        must be one, at least.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">replicateAllTables</p></td>
      <td align="left" valign="top"><p class="table">array of <a href="#JSONTableDefinition">JSONTableDefinition</a>
      </p></td>
      <td align="left" valign="top"><p class="table">The tables that are replicated to all the
        partitions.</p></td>
    </tr>
    </tbody>
  </table>
</div>
<div class="paragraph"><p>This is the spec of the JSONTableDefinition object:</p></div>
<div class="tableblock" id="JSONTableDefinition">
  <table rules="all"
         width="100%"
         frame="border"
         cellspacing="0" cellpadding="4">
    <caption class="title">Table 5. JSONTableDefinition object</caption>
    <col width="33%"/>
    <col width="33%"/>
    <col width="33%"/>
    <tbody>
    <tr>
      <td align="left" valign="top"><p class="table"><strong>Property</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Type</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Explanation</strong></p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">name</p></td>
      <td align="left" valign="top"><p class="table">string</p></td>
      <td align="left" valign="top"><p class="table">The name of the table.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">tableInputs</p></td>
      <td align="left" valign="top"><p class="table">array of <a href="#JSONTableInputDefinition">JSONTableInputDefinition</a>
      </p></td>
      <td align="left" valign="top"><p class="table">The input locations of this table.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">schema</p></td>
      <td align="left" valign="top"><p class="table">string</p></td>
      <td align="left" valign="top"><p class="table">The in-line Pangool schema that defines the
        structure of this table.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">partitionFields</p></td>
      <td align="left" valign="top"><p class="table">array of string</p></td>
      <td align="left" valign="top"><p class="table">If used, the table will be partitioned by one or
        more columns, otherwise it will be replicated to all partitions.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">indexes</p></td>
      <td align="left" valign="top"><p class="table">array of string</p></td>
      <td align="left" valign="top"><p class="table">List of columns that need to be indexed after the
        data is added to the table. You can also specify compound indexes here, comma-separated.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">preInsertStatements</p></td>
      <td align="left" valign="top"><p class="table">array of string</p></td>
      <td align="left" valign="top"><p class="table">Raw SQL commands that will be performed before
        inserting all the data to the table.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">finalStatements</p></td>
      <td align="left" valign="top"><p class="table">array of string</p></td>
      <td align="left" valign="top"><p class="table">Raw SQL commands that will be performed after
        inserting all the data to the table.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">insertionOrderBy</p></td>
      <td align="left" valign="top"><p class="table">string</p></td>
      <td align="left" valign="top"><p class="table">In-line Pangool Order By clause (in the form
        "field1:asc, field2:desc,&#8230;,fieldn:asc") that will be used for sorting the data before
        inserting it in a SQLite table.</p></td>
    </tr>
    </tbody>
  </table>
</div>
<div class="paragraph"><p>This is the spec of the <a href="#JSONTableInputDefinition">JSONTableInputDefinition</a>
  object:</p></div>
<div class="tableblock" id="JSONTableInputDefinition">
  <table rules="all"
         width="100%"
         frame="border"
         cellspacing="0" cellpadding="4">
    <caption class="title">Table 6. JSONTableInputDefinition object</caption>
    <col width="33%"/>
    <col width="33%"/>
    <col width="33%"/>
    <tbody>
    <tr>
      <td align="left" valign="top"><p class="table"><strong>Property</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Type</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Explanation</strong></p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">inputSpecs</p></td>
      <td align="left" valign="top"><p class="table"><a href="#TextInputSpecs">TextInputSpecs</a></p>
      </td>
      <td align="left" valign="top"><p class="table">Specifies how to parse the text file.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">paths</p></td>
      <td align="left" valign="top"><p class="table">array of string</p></td>
      <td align="left" valign="top"><p class="table">List of paths that will be used for creating this
        table.</p></td>
    </tr>
    </tbody>
  </table>
</div>
<div class="paragraph"><p>And this is the spec of the <a href="#TextInputSpecs">TextInputSpecs</a>
  object:</p></div>
<div class="tableblock" id="TextInputSpecs">
  <table rules="all"
         width="100%"
         frame="border"
         cellspacing="0" cellpadding="4">
    <caption class="title">Table 7. TextInputSpecs object</caption>
    <col width="33%"/>
    <col width="33%"/>
    <col width="33%"/>
    <tbody>
    <tr>
      <td align="left" valign="top"><p class="table"><strong>Property</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Type</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Explanation</strong></p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">separatorChar</p></td>
      <td align="left" valign="top"><p class="table">character</p></td>
      <td align="left" valign="top"><p class="table">The field separator in the file. By default, a
        tabulation.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">quotesChar</p></td>
      <td align="left" valign="top"><p class="table">character</p></td>
      <td align="left" valign="top"><p class="table">The quotes character, if any. By default, none.</p>
      </td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">escapeChar</p></td>
      <td align="left" valign="top"><p class="table">character</p></td>
      <td align="left" valign="top"><p class="table">The character used for escaping, if any. By default,
        none.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">skipHeader</p></td>
      <td align="left" valign="top"><p class="table">boolean</p></td>
      <td align="left" valign="top"><p class="table">If the CSV has a header, activate this property for
        not failing to parse it.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">strictQuotes</p></td>
      <td align="left" valign="top"><p class="table">boolean</p></td>
      <td align="left" valign="top"><p class="table">If quotesChar is specified, activating this property
        will cause all the fields without quotes to be considered null. False by default.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">nullString</p></td>
      <td align="left" valign="top"><p class="table">string</p></td>
      <td align="left" valign="top"><p class="table">A sequence of characters that, if found without
        quotes, will be considered null. None by default.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">fixedWidthFields</p></td>
      <td align="left" valign="top"><p class="table">array of integers</p></td>
      <td align="left" valign="top"><p class="table">If present, the file will be parsed as a fixed-width
        file. When used, you must provide a comma-separated list of numbers. These numbers will be
        interpreted by pairs, as [beginning, end] inclusive position offsets. For example: "0,3,5,7"
        means there are two fields, the first one of 4 characters at offsets [0, 3] and the second one of
        3 characters at offsets [5, 7].</p></td>
    </tr>
    </tbody>
  </table>
</div>
<h4 id="_deployer">Deployer</h4>

<div class="paragraph"><p>The "deployer" tool can be used for deploying any tablespace or set of
  tablespaces that has been generated by any of the generators. More than one tablespace may be deployed
  at the same time, and Splout will increment the version for all of them in an "all-or-nothing" fashion.
  For the common case of deploying only one tablespace, you can use straight command-line parameters:</p>
</div>
<div class="literalblock">
  <div class="content">
    <pre><tt>hadoop jar splout-hadoop-0.1-SNAPSHOT-hadoop.jar deploy -r 2 -root my-generated-tablespace
      -tn mytablespace -q http://localhost:4412</tt></pre>
  </div>
</div>
<div class="paragraph"><p>The above line will deploy binary files generated in "my-generated-tablespace"
  folder using replication 2. The deployed tablespace will be named "mytablespace" and it will be
  deployed to the alive Splout cluster using the local QNode address at port 4412.
  The corresponding expected file tree for this example would have been the following:</p></div>
<div class="literalblock">
  <div class="content">
<pre><tt>hdfs://.../my-generated-tablespace/
  hdfs://.../my-generated-tablespace/partition-map
  hdfs://.../my-generated-tablespace/sampled-input
  hdfs://.../my-generated-tablespace/store</tt></pre>
  </div>
</div>
<div class="paragraph"><p>(This file tree corresponds to the output of a "generator" process with
  "my-generated-tablespace" as output folder.)</p></div>
<div class="admonitionblock">
  <table>
    <tr>
      <td class="icon">
        <div class="title">Tip</div>
      </td>
      <td class="content">
        <div class="title">Replication</div>
        For failover, it is convenient to replicate your tablespace when deploying it. If ommitted, only
        one copy of each binary file will be distributed to the cluster, meaning that if one machine
        fails there will be a portion of your data that will not be available for serving. A replication
        factor of 2 will mean that there will be 2 copies of each file, so one machine can fail and all
        the data will still be served. When deploying to a cluster with less machines than the
        replication factor specified, it will be automatically downgraded to the minimum viable one.
      </td>
    </tr>
  </table>
</div>
<div class="paragraph"><p>For deploying more than one tablespace atomically and with the same replication
  factor, you can also use command-line parameters:</p></div>
<div class="literalblock">
  <div class="content">
    <pre><tt>hadoop jar splout-hadoop-0.1-SNAPSHOT-hadoop.jar deploy -r 2 -root my-root-folder -tn
      mytablespace1,mytablespace2,mytablespace3 -q http://localhost:4412</tt></pre>
  </div>
</div>
<div class="paragraph"><p>In this case we will deploy 3 tablespaces at the same time: mytablespace1,
  mytablespace2 and mytablespace3. The "root" parameter is a parent folder that contains the specified
  subfolders, and the tablespaces will be named after the folder name. So in this case the file tree
  structure is the following:</p></div>
<div class="literalblock">
  <div class="content">
<pre><tt>hdfs://.../my-root-folder/mytablespace1/partition-map
  hdfs://.../my-root-folder/mytablespace1/sampled-input
  hdfs://.../my-root-folder/mytablespace1/store/...
  hdfs://.../my-root-folder/mytablespace2/partition-map
  hdfs://.../my-root-folder/mytablespace2/sampled-input
  hdfs://.../my-root-folder/mytablespace2/store/...
  hdfs://.../my-root-folder/mytablespace3/partition-map
  hdfs://.../my-root-folder/mytablespace3/sampled-input
  hdfs://.../my-root-folder/mytablespace3/store/...</tt></pre>
  </div>
</div>
<div class="paragraph"><p>Last but not least, if we are to atomically deploy a more complex combination
  of tablespaces, we can also use a JSON configuration file for that. This file will contain an array of
  "TablespaceDepSpec" objects whose spec is the following:</p></div>
<div class="tableblock" id="TablespaceDepSpec">
  <table rules="all"
         width="100%"
         frame="border"
         cellspacing="0" cellpadding="4">
    <caption class="title">Table 8. TablespaceDepSpec object</caption>
    <col width="33%"/>
    <col width="33%"/>
    <col width="33%"/>
    <tbody>
    <tr>
      <td align="left" valign="top"><p class="table"><strong>Property</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Type</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Explanation</strong></p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">sourcePath</p></td>
      <td align="left" valign="top"><p class="table">string</p></td>
      <td align="left" valign="top"><p class="table">The root folder which contains one or more
        tablespaces and where this tablespace can be located.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">tablespace</p></td>
      <td align="left" valign="top"><p class="table">string</p></td>
      <td align="left" valign="top"><p class="table">The subfolder in the root folder that contains the
        tablespace. It will be used for its name.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">replication</p></td>
      <td align="left" valign="top"><p class="table">integer</p></td>
      <td align="left" valign="top"><p class="table">The replication factor to be used for this
        tablespace.</p></td>
    </tr>
    </tbody>
  </table>
</div>
<div class="paragraph"><p>In this case, we can just pass the configuration file like shown below, taking
  into account that the file must be present in the local file system:</p></div>
<div class="literalblock">
  <div class="content">
    <pre><tt>hadoop jar splout-hadoop-0.1-SNAPSHOT-hadoop.jar -c my-config.json -q
      http://localhost:4412</tt></pre>
  </div>
</div>
<h3 id="_hadoop_java_api">Hadoop Java API</h3>

<div style="clear:left"></div>
<div class="paragraph"><p>All the command-line tools use the underlying Java API that we have implemented
  for Splout. You can also use this Java API directly in your Java project and you can have access to
  more advanced features such as specifying custom partitioning functions, record processing functions
  and such.</p></div>
<h4 id="_basic_api">Basic API</h4>

<div class="paragraph"><p>The basic API consists of the following classes:</p></div>
<div class="ulist">
  <ul>
    <li>
      <p>
        <a href="apidocs/splout-hadoop/com/splout/db/hadoop/TableBuilder.html">TableBuilder</a>: a
        builder used to obtain a Table instance. Table instances can be used in TablespaceBuilder for
        constructing a tablespace specification.
      </p>
    </li>
    <li>
      <p>
        <a href="apidocs/splout-hadoop/com/splout/db/hadoop/TablespaceBuilder.html">TablespaceBuilder</a>:
        a builder used to obtain a TablespaceSpec instance.
      </p>
    </li>
    <li>
      <p>
        <a href="apidocs/splout-hadoop/com/splout/db/hadoop/TablespaceGenerator.html">TablespaceGenerator</a>:
        It can be used to generate the binary files according to a TablespaceSpec instance.
      </p>
    </li>
    <li>
      <p>
        <a href="apidocs/splout-hadoop/com/splout/db/hadoop/StoreDeployerTool.html">StoreDeployerTool</a>:
        It can be used to deploy the files generated by the <a
          href="apidocs/splout-hadoop/com/splout/db/hadoop/TablespaceGenerator.html">TablespaceGenerator</a>
        to an alive Splout cluster. It will accept <a href="#TablespaceDepSpec">TablespaceDepSpec</a>
        instances, which have been documented in the previous sections.
      </p>
    </li>
  </ul>
</div>
<div class="paragraph"><p>The javadoc of each of these classes should guide you well into using them in
  your custom Java project. In addition, you can <a
      href="https://github.com/datasalt/splout-db/blob/master/splout-hadoop/src/main/java/com/splout/db/examples/PageCountsExample.java">check
    this example</a> which uses the <a href="http://dom.as/2007/12/10/wikipedia-page-counters/">Wikipedia
    Pagecounts data</a> for seeing a practical example on how to use this programmatic API.</p></div>
<h5 id="_custom_partitioning">Custom partitioning</h5>

<div class="paragraph"><p>Aside of column-based partitioning, an arbitrary partitioning function can be
  provided in the form of a Javascript function. This function ca be passed to TableBuilder&#8217;s
  partitionByJavaScript() method.</p></div>
<h5 id="_recordprocessor">RecordProcessor</h5>

<div class="paragraph"><p>If you want to have more control on the generation process, you can implement
  your own RecordProcessor which will receive Tuples as they have been parsed by the input files and
  should emit Tuples as you want them to be indexed in your SQL tables.
  For example, you may choose to narrow your input Tuple and emit a subset of it, modify some field by
  decoding its content, and so on. The RecordProcessor may also act as a filter. If "null" is returned,
  the input Tuple would have been filtered out from the generation process.</p></div>
<div class="paragraph"><p>The <a
    href="https://github.com/datasalt/splout-db/blob/master/splout-hadoop/src/main/java/com/splout/db/examples/PageCountsRecordProcessor.java">pagecounts
  example RecordProcessor</a> is a good example.</p></div>
<div class="paragraph"><p><a href="user_guide.html"> &gt; Back to table of contents</a></p></div>
</div>
<h2 id="RESTAPI">REST API</h2>

<div class="sectionbody">
<div class="paragraph"><p>You can interact with the server through the <a
    href="apidocs/splout-javaclient/com/splout/db/common/SploutClient.html">Java client</a> or directly
  through the REST interface. These are the basic methods of the REST interface:</p></div>
<div class="tableblock">
  <table rules="all"
         width="100%"
         frame="border"
         cellspacing="0" cellpadding="4">
    <caption class="title">Table 9. Rest API overview</caption>
    <col width="20%"/>
    <col width="20%"/>
    <col width="20%"/>
    <col width="20%"/>
    <col width="20%"/>
    <tbody>
    <tr>
      <td align="left" valign="top"><p class="table"><strong>Method type</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Path</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Parameters</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Explanation</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Example</strong></p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">GET</p></td>
      <td align="left" valign="top"><p class="table">api/overview</p></td>
      <td align="left" valign="top"><p class="table">(none)</p></td>
      <td align="left" valign="top"><p class="table">Returns a <a href="#QNodeStatus">QNodeStatus</a>
        object with the overview of the cluster.</p></td>
      <td align="left" valign="top"><p class="table"><a href="http://localhost:4412/api/overview">http://localhost:4412/api/overview</a>
      </p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">GET</p></td>
      <td align="left" valign="top"><p class="table">api/dnodelist</p></td>
      <td align="left" valign="top"><p class="table">(none)</p></td>
      <td align="left" valign="top"><p class="table">Returns the list of DNodes in the cluster.</p></td>
      <td align="left" valign="top"><p class="table"><a href="http://localhost:4412/api/dnodelist">http://localhost:4412/api/dnodelist</a>
      </p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">GET</p></td>
      <td align="left" valign="top"><p class="table">api/tablespaces</p></td>
      <td align="left" valign="top"><p class="table">(none)</p></td>
      <td align="left" valign="top"><p class="table">Returns the list of active tablespaces in the
        cluster.</p></td>
      <td align="left" valign="top"><p class="table"><a href="http://localhost:4412/api/tablespaces">http://localhost:4412/api/tablespaces</a>
      </p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">GET</p></td>
      <td align="left" valign="top"><p class="table">api/tablespace/{tablespace}</p></td>
      <td align="left" valign="top"><p class="table">(none)</p></td>
      <td align="left" valign="top"><p class="table">Returns a Tablespace object with the info for this
        particular tablespace.</p></td>
      <td align="left" valign="top"><p class="table"><a
          href="http://localhost:4412/api/tablespace/mytablespace">http://localhost:4412/api/tablespace/mytablespace</a>
      </p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">GET</p></td>
      <td align="left" valign="top"><p class="table">api/tablespace/{tablespace}/versions</p></td>
      <td align="left" valign="top"><p class="table">(none)</p></td>
      <td align="left" valign="top"><p class="table">Returns a Map&lt;Long, <a href="#Tablespace">Tablespace</a>&gt;
        object with all the available versions for this tablespace.</p></td>
      <td align="left" valign="top"><p class="table"><a
          href="http://localhost:4412/api/tablespace/mytablespace/versions">http://localhost:4412/api/tablespace/mytablespace/versions</a>
      </p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">GET</p></td>
      <td align="left" valign="top"><p class="table">api/dnode/{dnode}/status</p></td>
      <td align="left" valign="top"><p class="table">(none)</p></td>
      <td align="left" valign="top"><p class="table">Returns a <a href="#DNodeSystemStatus">DNodeSystemStatus</a>
        object for the specified dnode.</p></td>
      <td align="left" valign="top"><p class="table"><a
          href="http://localhost:4412/api/dnode/localhost:4422/status">http://localhost:4412/api/dnode/localhost:4422/status</a>
      </p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">GET</p></td>
      <td align="left" valign="top"><p class="table">api/query/{tablespace}</p></td>
      <td align="left" valign="top"><p class="table">key, sql, [callback]</p></td>
      <td align="left" valign="top"><p class="table">Performs a SQL query to the specified tablespace and
        returns a QueryStatus object.</p></td>
      <td align="left" valign="top"><p class="table"><a
          href="http://localhost:4412/api/mytablespace?key=K1&amp;sql=SELECT%201">http://localhost:4412/api/mytablespace?key=K1&amp;sql=SELECT%201</a>;
      </p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">POST</p></td>
      <td align="left" valign="top"><p class="table">api/deploy</p></td>
      <td align="left" valign="top"><p class="table">List&lt;DeployRequest&gt;</p></td>
      <td align="left" valign="top"><p class="table">Performs a deploy according to the associated <a
          href="#DeployRequest">DeployRequest</a> objects passed as body for the request and returns a <a
          href="#DeployInfo">DeployInfo</a> object.</p></td>
      <td align="left" valign="top"><p class="table"></p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">POST</p></td>
      <td align="left" valign="top"><p class="table">api/rollback</p></td>
      <td align="left" valign="top"><p class="table">List&lt;SwitchVersionRequest&gt;</p></td>
      <td align="left" valign="top"><p class="table">Performs a rollback according to the associated <a
          href="#DeployRequest">DeployRequest</a> objects passed as body for the request and returns a <a
          href="#StatusMessage">StatusMessage</a> object.</p></td>
      <td align="left" valign="top"><p class="table"></p></td>
    </tr>
    </tbody>
  </table>
</div>
<div class="paragraph"><p>Following we will see each method with a little more detail:</p></div>
<h3 id="_api_overview">api/overview</h3>

<div style="clear:left"></div>
<div class="paragraph"><p>Use this method for obtaining an overview on the cluster status. Returns a
  QNodeStatus status object.
  Example response:</p></div>
<div class="literalblock">
  <div class="content">
<pre><tt>{
  dNodes: {
  192.168.1.3:4422: {
  average: "NaN",
  files: [ ],
  freeSpaceInDisk: 289065160,
  upSince: 1354124108706,
  nQueries: 0,
  failedQueries: 0,
  slowQueries: 0,
  systemStatus: "UP",
  deployInProgress: false,
  occupiedSpaceInDisk: 0,
  lastExceptionTime: -1
  }
  },
  tablespaceMap: { },
  clusterSize: 2
  }</tt></pre>
  </div>
</div>
<div class="tableblock" id="QNodeStatus">
  <table rules="all"
         width="100%"
         frame="border"
         cellspacing="0" cellpadding="4">
    <caption class="title">Table 10. QNodeStatus object</caption>
    <col width="33%"/>
    <col width="33%"/>
    <col width="33%"/>
    <tbody>
    <tr>
      <td align="left" valign="top"><p class="table"><strong>Property</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Type</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Explanation</strong></p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">dNodes</p></td>
      <td align="left" valign="top"><p class="table">Map&lt;String, <a href="#DNodeSystemStatus">DNodeSystemStatus</a>&gt;
      </p></td>
      <td align="left" valign="top"><p class="table">Alive DNodes in cluster and their associated
        information.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">tablespaceMap</p></td>
      <td align="left" valign="top"><p class="table">Map&lt;String, <a href="#Tablespace">Tablespace</a>&gt;
      </p></td>
      <td align="left" valign="top"><p class="table">Current tablespaces being served by the cluster and
        their associated information.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">clusterSize</p></td>
      <td align="left" valign="top"><p class="table">integer</p></td>
      <td align="left" valign="top"><p class="table">Number of services (QNodes + DNodes) in the
        cluster.</p></td>
    </tr>
    </tbody>
  </table>
</div>
<div class="tableblock" id="DNodeSystemStatus">
  <table rules="all"
         width="100%"
         frame="border"
         cellspacing="0" cellpadding="4">
    <caption class="title">Table 11. DNodeSystemStatus object</caption>
    <col width="33%"/>
    <col width="33%"/>
    <col width="33%"/>
    <tbody>
    <tr>
      <td align="left" valign="top"><p class="table"><strong>Property</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Type</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Explanation</strong></p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">systemStatus</p></td>
      <td align="left" valign="top"><p class="table">string</p></td>
      <td align="left" valign="top"><p class="table">"UP" if everything is fine. Otherwise "Last
        exception" together with a short Exception message will appear indicating that some Java
        Exception was thrown by the DNode.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">lastExceptionTime</p></td>
      <td align="left" valign="top"><p class="table">long</p></td>
      <td align="left" valign="top"><p class="table">The time when the last Java Exception was thrown
        corresponding to the sytemStatus caption.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">deployInProgress</p></td>
      <td align="left" valign="top"><p class="table">boolean</p></td>
      <td align="left" valign="top"><p class="table">Whether the DNode is fetching data for a deployment
        or not.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">upSince</p></td>
      <td align="left" valign="top"><p class="table">long</p></td>
      <td align="left" valign="top"><p class="table">The time when this DNode was started.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">nQueries</p></td>
      <td align="left" valign="top"><p class="table">int</p></td>
      <td align="left" valign="top"><p class="table">The number of queries that this DNode has
        served.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">failedQueries</p></td>
      <td align="left" valign="top"><p class="table">int</p></td>
      <td align="left" valign="top"><p class="table">The number of queries that this DNode has failed to
        serve.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">slowQueries</p></td>
      <td align="left" valign="top"><p class="table">double</p></td>
      <td align="left" valign="top"><p class="table">The number of queries considered to be "slow". Slow
        queries are configured by configuration property "dnode.slow.query.abs.limit".</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">average</p></td>
      <td align="left" valign="top"><p class="table">double</p></td>
      <td align="left" valign="top"><p class="table">The average query time for this DNode.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">occupiedSpaceInDisk</p></td>
      <td align="left" valign="top"><p class="table">long</p></td>
      <td align="left" valign="top"><p class="table">The number of bytes occupied by the data that this
        DNode holds.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">freeSpaceInDisk</p></td>
      <td align="left" valign="top"><p class="table">long</p></td>
      <td align="left" valign="top"><p class="table">The free disk space in the disk that this DNode is
        using.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">files</p></td>
      <td align="left" valign="top"><p class="table">List&lt;String&gt;</p></td>
      <td align="left" valign="top"><p class="table">The list of files for this DNode, and the size of
        each file in parenthesis.</p></td>
    </tr>
    </tbody>
  </table>
</div>
<div class="tableblock" id="Tablespace">
  <table rules="all"
         width="100%"
         frame="border"
         cellspacing="0" cellpadding="4">
    <caption class="title">Table 12. Tablespace object</caption>
    <col width="33%"/>
    <col width="33%"/>
    <col width="33%"/>
    <tbody>
    <tr>
      <td align="left" valign="top"><p class="table"><strong>Property</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Type</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Explanation</strong></p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">partitionMap</p></td>
      <td align="left" valign="top"><p class="table"><a href="#PartitionMap">PartitionMap</a></p></td>
      <td align="left" valign="top"><p class="table">The partition map that is being used to route
        queries for this tablespace.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">replicationMap</p></td>
      <td align="left" valign="top"><p class="table"><a href="#ReplicationMap">ReplicationMap</a></p>
      </td>
      <td align="left" valign="top"><p class="table">The replication map that is being used for failover
        for this tablespace.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">version</p></td>
      <td align="left" valign="top"><p class="table">long</p></td>
      <td align="left" valign="top"><p class="table">The version number of this tablespace.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">creationDate</p></td>
      <td align="left" valign="top"><p class="table">long</p></td>
      <td align="left" valign="top"><p class="table">The time when this tablespace was deployed.</p></td>
    </tr>
    </tbody>
  </table>
</div>
<div class="tableblock" id="PartitionMap">
  <table rules="all"
         width="100%"
         frame="border"
         cellspacing="0" cellpadding="4">
    <caption class="title">Table 13. PartitionMap object</caption>
    <col width="33%"/>
    <col width="33%"/>
    <col width="33%"/>
    <tbody>
    <tr>
      <td align="left" valign="top"><p class="table"><strong>Property</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Type</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Explanation</strong></p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">partitionEntries</p></td>
      <td align="left" valign="top"><p class="table">List&lt;<a href="#PartitionEntry">PartitionEntry</a>&gt;
      </p></td>
      <td align="left" valign="top"><p class="table">The list of partition entries with (min, max) ranges
        for this tablespace.</p></td>
    </tr>
    </tbody>
  </table>
</div>
<div class="tableblock" id="PartitionEntry">
  <table rules="all"
         width="100%"
         frame="border"
         cellspacing="0" cellpadding="4">
    <caption class="title">Table 14. PartitionEntry object</caption>
    <col width="33%"/>
    <col width="33%"/>
    <col width="33%"/>
    <tbody>
    <tr>
      <td align="left" valign="top"><p class="table"><strong>Property</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Type</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Explanation</strong></p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">min</p></td>
      <td align="left" valign="top"><p class="table">string</p></td>
      <td align="left" valign="top"><p class="table">If a key falls between [min, max) it will be routed
        to this shard. Min is inclusive.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">max</p></td>
      <td align="left" valign="top"><p class="table">string</p></td>
      <td align="left" valign="top"><p class="table">If a key falls between [min, max) it will be routed
        to this shard. Max is not inclusive.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">shard</p></td>
      <td align="left" valign="top"><p class="table">int</p></td>
      <td align="left" valign="top"><p class="table">If a key falls between [min, max) it will be routed
        to this shard.</p></td>
    </tr>
    </tbody>
  </table>
</div>
<div class="tableblock" id="ReplicationMap">
  <table rules="all"
         width="100%"
         frame="border"
         cellspacing="0" cellpadding="4">
    <caption class="title">Table 15. ReplicationMap object</caption>
    <col width="33%"/>
    <col width="33%"/>
    <col width="33%"/>
    <tbody>
    <tr>
      <td align="left" valign="top"><p class="table"><strong>Property</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Type</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Explanation</strong></p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">replicationEntries</p></td>
      <td align="left" valign="top"><p class="table">List&lt;<a
          href="#ReplicationEntry">ReplicationEntry</a>&gt;</p></td>
      <td align="left" valign="top"><p class="table">The list of replication entries with list of dnodes
        for this tablespace.</p></td>
    </tr>
    </tbody>
  </table>
</div>
<div class="tableblock" id="ReplicationEntry">
  <table rules="all"
         width="100%"
         frame="border"
         cellspacing="0" cellpadding="4">
    <caption class="title">Table 16. ReplicationEntry object</caption>
    <col width="33%"/>
    <col width="33%"/>
    <col width="33%"/>
    <tbody>
    <tr>
      <td align="left" valign="top"><p class="table"><strong>Property</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Type</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Explanation</strong></p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">shard</p></td>
      <td align="left" valign="top"><p class="table">int</p></td>
      <td align="left" valign="top"><p class="table">This shard can be served by any dnode in the "nodes"
        list.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">nodes</p></td>
      <td align="left" valign="top"><p class="table">list&lt;string&gt;</p></td>
      <td align="left" valign="top"><p class="table">This shard can be served by any dnode in the "nodes"
        list.</p></td>
    </tr>
    </tbody>
  </table>
</div>
<h3 id="_api_dnodelist">api/dnodelist</h3>

<div style="clear:left"></div>
<div class="paragraph"><p>Use this method for getting the list of alive DNodes. Returns a list of
  strings. Example response:</p></div>
<div class="literalblock">
  <div class="content">
<pre><tt>[
  "192.168.1.3:4422",
  "192.168.1.4:4422",
  ]</tt></pre>
  </div>
</div>
<h3 id="_api_tablespaces">api/tablespaces</h3>

<div style="clear:left"></div>
<div class="paragraph"><p>Use this method for getting the list of tablespaces being served in the
  cluster. Returns a list of strings. Example reponse:</p></div>
<div class="literalblock">
  <div class="content">
<pre><tt>[
  "pagecounts"
  ]</tt></pre>
  </div>
</div>
<h3 id="_api_tablespace_tablespace">api/tablespace/{tablespace}</h3>

<div style="clear:left"></div>
<div class="paragraph"><p>Use this method for getting the associated information of a tablespace being
  served by the cluster. Returns a <a href="#Tablespace">Tablespace</a> object. Example response:</p>
</div>
<div class="literalblock">
  <div class="content">
<pre><tt>{
  partitionMap: {
  partitionEntries: [
  {
  shard: 0,
  max: "Sp",
  min: null
  },
  {
  shard: 1,
  max: null,
  min: "Sp"
  }
  ]
  },
  version: 5649092059,
  replicationMap: {
  replicationEntries: [
  {
  shard: 0,
  nodes: [
  "192.168.1.3:4422"
  ]
  },
  {
  shard: 1,
  nodes: [
  "192.168.1.3:4422"
  ]
  }
  ]
  },
  creationDate: 1354124763853
  }</tt></pre>
  </div>
</div>
<h3 id="_api_tablespace_tablespace_versions">api/tablespace/{tablespace}/versions</h3>

<div style="clear:left"></div>
<div class="paragraph"><p>Returns all available versions for the specified tablespace, including the one
  which may be being served at the moment by the cluster. Returns a Map&lt;Long, <a href="#Tablespace">[Tablespace]</a>&gt;.
  For every version in the key of the map, returns the associated <a href="#Tablespace">Tablespace</a>
  object information. Example response:</p></div>
<div class="literalblock">
  <div class="content">
<pre><tt>{
  5649092059:
  partitionMap: {
  partitionEntries: [
  {
  shard: 0,
  max: "Sp",
  min: null
  },
  {
  shard: 1,
  max: null,
  min: "Sp"
  }
  ]
  },
  version: 5649092059,
  replicationMap: {
  replicationEntries: [
  {
  shard: 0,
  nodes: [
  "192.168.1.3:4422"
  ]
  },
  {
  shard: 1,
  nodes: [
  "192.168.1.3:4422"
  ]
  }
  ]
  },
  creationDate: 1354124763853
  }
  }</tt></pre>
  </div>
</div>
<h3 id="_api_dnode_dnode_status">api/dnode/{dnode}/status</h3>

<div style="clear:left"></div>
<div class="paragraph"><p>Returns a <a href="#DNodeSystemStatus">DNodeSystemStatus</a> object filled with
  the detailed information of the specified DNode. Example response:</p></div>
<div class="literalblock">
  <div class="content">
<pre><tt>{
  average: "NaN",
  files: [
  "/var/opt/splout/./dnode-staging (13512 bytes)",
  "/var/opt/splout/./dnode-staging/pagecounts (13512 bytes)",
  "/var/opt/splout/./dnode-staging/pagecounts/5649092059 (13512 bytes)",
  "/var/opt/splout/./dnode-staging/pagecounts/5649092059/0 (3072 bytes)",
  "/var/opt/splout/./dnode-staging/pagecounts/5649092059/0.meta (100 bytes)",
  "/var/opt/splout/./dnode-staging/pagecounts/5649092059/0/0.db (3072 bytes)",
  "/var/opt/splout/./dnode-staging/pagecounts/5649092059/1 (10240 bytes)",
  "/var/opt/splout/./dnode-staging/pagecounts/5649092059/1.meta (100 bytes)",
  "/var/opt/splout/./dnode-staging/pagecounts/5649092059/1/1.db (10240 bytes)"
  ],
  freeSpaceInDisk: 289059948,
  upSince: 1354124108706,
  nQueries: 0,
  failedQueries: 0,
  slowQueries: 0,
  systemStatus: "UP",
  deployInProgress: false,
  occupiedSpaceInDisk: 13512,
  lastExceptionTime: -1
  }</tt></pre>
  </div>
</div>
<h3 id="_api_query_tablespace">api/query/{tablespace}</h3>

<div style="clear:left"></div>
<div class="paragraph"><p>Perform a SQL query and get a JSON result back. Returns a QueryStatus object
  with some metadata about the query execution. Example response for key=Up, sql=SELECT * FROM pagecounts
  LIMIT 1 and tablespace pagecounts (<a
      href="http://localhost:4412/api/query/pagecounts?key=Up&amp;sql=SELECT%20*%20FROM%20pagecounts%20LIMIT%201">http://localhost:4412/api/query/pagecounts?key=Up&amp;sql=SELECT%20*%20FROM%20pagecounts%20LIMIT%201</a>;):
</p></div>
<div class="literalblock">
  <div class="content">
<pre><tt>{
  "millis": 135,
  "error":null,
  "result": [
  {
  "pagename": "zh:注音符號",
  "hour": "23",
  "pageviews": 1,
  "date": "20090430"
  }
  ],
  "shard": 1
  }</tt></pre>
  </div>
</div>
<div class="tableblock">
  <table rules="all"
         width="100%"
         frame="border"
         cellspacing="0" cellpadding="4">
    <caption class="title">Table 17. QueryStatus object</caption>
    <col width="33%"/>
    <col width="33%"/>
    <col width="33%"/>
    <tbody>
    <tr>
      <td align="left" valign="top"><p class="table"><strong>Property</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Type</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Explanation</strong></p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">result</p></td>
      <td align="left" valign="top"><p class="table">list&lt;Object&gt;</p></td>
      <td align="left" valign="top"><p class="table">The query result from the database, which has been
        JSONified. If there was an error, it will be empty.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">shard</p></td>
      <td align="left" valign="top"><p class="table">int</p></td>
      <td align="left" valign="top"><p class="table">The shard that the query was routed to.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">millis</p></td>
      <td align="left" valign="top"><p class="table">long</p></td>
      <td align="left" valign="top"><p class="table">The time the query took to be executed.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">error</p></td>
      <td align="left" valign="top"><p class="table">string</p></td>
      <td align="left" valign="top"><p class="table">The error message if there was any.</p></td>
    </tr>
    </tbody>
  </table>
</div>
<h3 id="_api_deploy">api/deploy</h3>

<div style="clear:left"></div>
<div class="admonitionblock">
  <table>
    <tr>
      <td class="icon">
        <div class="title">Warning</div>
      </td>
      <td class="content">You won&#8217;t usually need to perform a deploy manually using this REST
        method. However, you can refer to this documentation in case
        you need to do something very specific. For doing deploys you will usually use the "deployer"
        command-line tool or the <a
            href="apidocs/splout-hadoop/com/splout/db/hadoop/StoreDeployerTool.html">StoreDeployerTool</a>
        Java class.
      </td>
    </tr>
  </table>
</div>
<div class="paragraph"><p>By providing a list of <a href="#DeployRequest">DeployRequest</a> objects we
  can perform a deploy through this POST method. We need to specify a tablespace name,
  an URI from where binary objects must be fetched, a <a href="#PartitionMap">PartitionMap</a> and a <a
      href="#ReplicationMap">ReplicationMap</a> and optionally a list of SQL statements that will
  be executed each time a connection is made to the database.</p></div>
<div class="paragraph"><p>Example post body:</p></div>
<div class="literalblock">
  <div class="content">
<pre><tt>[
  {
  "tablespace": "pagecounts",
  "data_uri": "file:/opt/splout-db/splout-hadoop/out-pagecounts/store",
  "partitionMap": [
  {
  "min": null,
  "max": "Sp",
  "shard":0
  },
  {
  "min": "Sp",
  "max": null,
  "shard":1
  }
  ],
  "replicationMap": [
  {
  "shard": 0,
  "nodes": [
  "192.168.1.3:4422"
  ]
  },
  {
  "shard": 1,
  "nodes": ["192.168.1.3:4422"]
  }
  ],
  "initStatements": [
  "pragma case_sensitive_like=true;"
  ]
  }
  ]</tt></pre>
  </div>
</div>
<div class="tableblock" id="DeployRequest">
  <table rules="all"
         width="100%"
         frame="border"
         cellspacing="0" cellpadding="4">
    <caption class="title">Table 18. DeployRequest object</caption>
    <col width="33%"/>
    <col width="33%"/>
    <col width="33%"/>
    <tbody>
    <tr>
      <td align="left" valign="top"><p class="table"><strong>Property</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Type</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Explanation</strong></p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">tablespace</p></td>
      <td align="left" valign="top"><p class="table">string</p></td>
      <td align="left" valign="top"><p class="table">The tablespace name. It will be used as identifier
        after being deployed if it doesn&#8217;t exist. If it exists, a new version will be promoted for
        it.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">data_uri</p></td>
      <td align="left" valign="top"><p class="table">string</p></td>
      <td align="left" valign="top"><p class="table">The absolute URI where the binary files can be
        found.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">initStatements</p></td>
      <td align="left" valign="top"><p class="table">list&lt;string&gt;</p></td>
      <td align="left" valign="top"><p class="table">A list of SQL statements that will be executed
        everytime a connection is made to the database files. Useful for using custom SQLite PRAGMAs.</p>
      </td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">partitionMap</p></td>
      <td align="left" valign="top"><p class="table">list&lt;<a
          href="#PartitionEntry">[PartitionEntry]</a>&gt;</p></td>
      <td align="left" valign="top"><p class="table">The Partition map to be used for routing queries
        from this tablespace.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">replicationMap</p></td>
      <td align="left" valign="top"><p class="table">list&lt;<a href="#ReplicationEntry">[ReplicationEntry]</a>&gt;
      </p></td>
      <td align="left" valign="top"><p class="table">The Replication map to be used for failover for this
        tablespace.</p></td>
    </tr>
    </tbody>
  </table>
</div>
<div class="admonitionblock">
  <table>
    <tr>
      <td class="icon">
        <div class="title">Tip</div>
      </td>
      <td class="content">Java users can use <a
          href="apidocs/splout-javaclient/com/splout/db/common/SploutClient.html">SploutClient</a> or
        higher-level <a href="apidocs/splout-hadoop/com/splout/db/hadoop/StoreDeployerTool.html">StoreDeployerTool</a>
        (which uses apidocs/splout-javaclient/com/splout/db/common/SploutClient.html[SploutClient]
        underneath) instead of the raw REST API for doing deploys.
      </td>
    </tr>
  </table>
</div>
<div class="admonitionblock">
  <table>
    <tr>
      <td class="icon">
        <div class="title">Tip</div>
      </td>
      <td class="content">Partition maps are automatically generated by sampling methods in the generator
        tools and saved in the output folder that was used for the tool. The tools use the <a
            href="apidocs/splout-hadoop/com/splout/db/hadoop/TablespaceGenerator.html">TablespaceGenerator</a>
        Java class underneath.
      </td>
    </tr>
  </table>
</div>
<div class="admonitionblock">
  <table>
    <tr>
      <td class="icon">
        <div class="title">Tip</div>
      </td>
      <td class="content">Typical replication maps can be built easily with the Java API methods <a
          href="apidocs/splout-commons/com/splout/db/common/ReplicationMap.html">ReplicationMap.roundRobinMap()</a>
        and <a href="apidocs/splout-commons/com/splout/db/common/ReplicationMap.html">ReplicationMap.oneToOneMap()</a>.
      </td>
    </tr>
  </table>
</div>
<div class="paragraph"><p>The deploy is an asynchronous operation coordinated by the cluster members. A
  deploy request returns inmediately with a <a href="#DeployInfo">[DeployInfo]</a> object indicating
  whether it could be started or whether there was some error trying to start it:</p></div>
<div class="tableblock" id="DeployInfo">
  <table rules="all"
         width="100%"
         frame="border"
         cellspacing="0" cellpadding="4">
    <caption class="title">Table 19. DeployInfo object</caption>
    <col width="33%"/>
    <col width="33%"/>
    <col width="33%"/>
    <tbody>
    <tr>
      <td align="left" valign="top"><p class="table"><strong>Property</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Type</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Explanation</strong></p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">error</p></td>
      <td align="left" valign="top"><p class="table">string</p></td>
      <td align="left" valign="top"><p class="table">If there is any error starting the deploy.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">string</p></td>
      <td align="left" valign="top"><p class="table">startedAt</p></td>
      <td align="left" valign="top"><p class="table">A timestamp indicating the time when this deploy
        started.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">version</p></td>
      <td align="left" valign="top"><p class="table">long</p></td>
      <td align="left" valign="top"><p class="table">The version number that the tablespace will have
        when the deploy is promoted.</p></td>
    </tr>
    </tbody>
  </table>
</div>
<h3 id="_api_rollback">api/rollback</h3>

<div style="clear:left"></div>
<div class="paragraph"><p>By providing a list of <a href="#SwitchVersionRequest">SwitchVersionRequest</a>
  objects we can perform a rollback through this POST method. We just need to specify the tablespace
  name (which must be being served by the cluster at the moment of the rollback) and the version we want
  to set it to.</p></div>
<div class="tableblock" id="SwitchVersionRequest">
  <table rules="all"
         width="100%"
         frame="border"
         cellspacing="0" cellpadding="4">
    <caption class="title">Table 20. SwitchVersionRequest object</caption>
    <col width="33%"/>
    <col width="33%"/>
    <col width="33%"/>
    <tbody>
    <tr>
      <td align="left" valign="top"><p class="table"><strong>Property</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Type</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Explanation</strong></p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">tablespace</p></td>
      <td align="left" valign="top"><p class="table">string</p></td>
      <td align="left" valign="top"><p class="table">The tablespace name, used as identifier.</p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">version</p></td>
      <td align="left" valign="top"><p class="table">long</p></td>
      <td align="left" valign="top"><p class="table">The version to rollback to. It must be available in
        the cluster.</p></td>
    </tr>
    </tbody>
  </table>
</div>
<div class="admonitionblock">
  <table>
    <tr>
      <td class="icon">
        <div class="title">Tip</div>
      </td>
      <td class="content">Java users can use <a
          href="apidocs/splout-javaclient/com/splout/db/common/SploutClient.html">SploutClient</a>
        instead of the raw REST API for doing rollbacks.
      </td>
    </tr>
  </table>
</div>
<div class="paragraph"><p>Rollback is a synchronous operation and the return type is <a
    href="#StatusMessage">[StatusMessage]</a>:</p></div>
<div class="tableblock" id="StatusMessage">
  <table rules="all"
         width="100%"
         frame="border"
         cellspacing="0" cellpadding="4">
    <caption class="title">Table 21. StatusMessage object</caption>
    <col width="33%"/>
    <col width="33%"/>
    <col width="33%"/>
    <tbody>
    <tr>
      <td align="left" valign="top"><p class="table"><strong>Property</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Type</strong></p></td>
      <td align="left" valign="top"><p class="table"><strong>Explanation</strong></p></td>
    </tr>
    <tr>
      <td align="left" valign="top"><p class="table">status</p></td>
      <td align="left" valign="top"><p class="table">string</p></td>
      <td align="left" valign="top"><p class="table">"Done" if it could be done, otherwise an error will
        be printed here.</p></td>
    </tr>
    </tbody>
  </table>
</div>
<div class="paragraph"><p><a href="user_guide.html"> &gt; Back to table of contents</a></p></div>
</div>
<h2 id="_tips_troubleshooting">Tips / Troubleshooting</h2>

<div class="sectionbody">
  <div class="paragraph"><p>In this section we will take a look to the common problems or tips that one
    has to take into account when using Splout:</p></div>
  <h3 id="_query_speed">Query speed</h3>

  <div style="clear:left"></div>
  <div class="paragraph"><p>There are a wide variety of reasons why queries may or may not perform well.
    It is important to understand that each query is executed in a SQLite connection of a binary SQLite
    file.
    When troubleshooting query performance, it is advisable to take a look to the <a
        href="http://www.sqlite.org/">SQLite documentation</a>
    and in addition check things like:</p></div>
  <div class="ulist">
    <ul>
      <li>
        <p>
          PRAGMA index_list(table) - to check if we have created the appropriated indexes or not.
        </p>
      </li>
      <li>
        <p>
          EXPLAIN QUERY PLAN (query) - to show if SQLite is using the expected indexes or not.
        </p>
      </li>
      <li>
        <p>
          PRAGMA case_sensitive_like - when doing LIKE queries, SQLite will use an index only if this
          pragma is set to true and the index was created using standard collation, or if this pragma is
          set to false and the index was created using COLLATE NOCASE.
        </p>
      </li>
    </ul>
  </div>
  <div class="paragraph"><p>Remember that you can fine-tune your data indexing process with
    preInsertStatements, finalStatements
    (see <a href="#JSONTableDefinition">[JSONTableDefinition]</a>) and initStatements (see <a
        href="#DeployRequest">[DeployRequest]</a>). All these features are available as part of
    the standard Java API of <a href="apidocs/splout-hadoop/com/splout/db/hadoop/TableBuilder.html">TableBuilder</a>
    and
    <a href="apidocs/splout-hadoop/com/splout/db/hadoop/TablespaceBuilder.html">TablespaceBuilder</a>.
    Use them for adding custom PRAGMA or custom CREATE INDEX commands if needed.</p></div>
  <div class="paragraph"><p>It is also very important to keep in mind that colocating data in disk is
    crucial for query speed. For example, if your query impacts 1000 records and these records need to be
    loaded from the main table, if they are not colocated in disk and the database doesn&#8217;t fit in
    memory, it would mean that the server has to peform 1000 potential seeks.
    You can control the data colocation policy with "insertionOrderBy" as explained in <a
        href="#JSONTableDefinition">[JSONTableDefinition]</a>, which is also available in <a
        href="apidocs/splout-hadoop/com/splout/db/hadoop/TableBuilder.html">TableBuilder</a>.</p></div>
  <div class="paragraph"><p>As an example, we have used data colocation techniques within Splout SQL to
    obtain &lt; 50ms average query time with 10 threads on dynamic GROUP BY&#8217;s that hit an average
    of 2000 records each in a multi-gigabyte database that exceeded available RAM in orders of magnitude
    in a m1.small EC2 machine.</p></div>
  <h3 id="_deploys_failing_or_taking_too_long">Deploys failing or taking too long</h3>

  <div style="clear:left"></div>
  <div class="paragraph"><p>Because deployments are asynchronous operations, it can be tricky to know if
    they have succeeded or not. You can monitor a deployment using the information returned by the <a
        href="#RESTAPI">API</a> (deployInProgress flags).</p></div>
  <div class="paragraph"><p>A deploy may fail if some of the DNodes fail, if a timeout is reached (see <a
      href="#splout_configuration">Configuration</a>) or if the leader QNode dies. The default timeout is
    10 hours, so it shouldn&#8217;t be hit under normal circumstances.</p></div>
  <h3 id="_the_cluster_is_inconsistent_there_are_less_dnodes_than_expected">The cluster is inconsistent:
    there are less DNodes than expected</h3>

  <div style="clear:left"></div>
  <div class="paragraph"><p>In big networks in can take some time for Hazelcast to negotiate the
    membership. It can be a matter of minutes.</p></div>
</div>
</div>
<div id="footnotes">
  <hr/>
</div>
<div id="footer">
  <div id="footer-text">
    Last updated 2012-11-29 17:42:43 CEST
  </div>
</div>


<br><br><br><br>
<!-- Footer -->
<footer class="footer">
  <p class="pull-right"><a href="http://datasalt.com">Splout is maintained by Datasalt</a></p>
</footer>
</div>
<!-- /container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/bootswatch.js"></script>
</body>
</html>
