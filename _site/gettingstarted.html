<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Getting started with Splout SQL</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- Le styles -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/bootstrap-responsive.min.css" rel="stylesheet">

  <!-- Modified asciidoc css -->
  <link rel="stylesheet" href="./css/xhtml11.css" type="text/css"/>
  <link rel="stylesheet" href="./css/xhtml11-quirks.css" type="text/css"/>

  <script src="js/asciidoc.js"></script>

  <style>

    /* GLOBAL STYLES
    -------------------------------------------------- */
    /* Padding below the footer and lighter body text */

    p, h1, h2, h3, h4, h5 {
    padding-bottom: 5px; /* general breathing for everything */
    }

    body {
    padding-bottom: 40px;
    color: #5a5a5a;
    }

    dt {
    padding-bottom: 5px;
    font-size:20px;
    }

    dl {
    padding-bottom: 15px;
    }

    div#toc a:visited {
    color: #dd4814 !important;
    }

    /* Carousel base class */
    .carousel {
    margin-bottom: 60px;
    }

    .carousel .container {
    position: absolute;
    right: 0;
    bottom: 0;
    left: 0;
    }

    .carousel-control {
    background-color: transparent;
    border: 0;
    font-size: 120px;
    margin-top: 0;
    text-shadow: 0 1px 1px rgba(0,0,0,.4);
    }

    .carousel .item {
    height: 250px;
    }
    .carousel img {
    min-width: 100%;
    height: 250px;
    }

    .carousel-caption {
    background-color: transparent;
    position: static;
    max-width: 550px;
    padding: 0 20px;
    margin-bottom: 100px;
    }
    .carousel-caption h1,
    .carousel-caption .lead {
    margin: 0;
    line-height: 1.25;
    color: #fff;
    text-shadow: 0 1px 1px rgba(0,0,0,.4);
    }

    .carousel-caption .btn {
    margin-top: 10px;
    }

    /* RESPONSIVE CSS
    -------------------------------------------------- */

    @media (max-width: 979px) {
    .container.navbar-wrapper {
    margin-bottom: 0;
    width: auto;
    }
    .navbar-inner {
    border-radius: 0;
    margin: -20px 0;
    }

    .carousel .item {
    height: 300px;
    }
    .carousel img {
    width: auto;
    height: 300px;
    }
    }

    @media (max-width: 767px) {
    .navbar-inner {
    margin: -20px;
    }
    .carousel {
    margin-left: -20px;
    margin-right: -20px;
    }
    .carousel .container {
    }
    .carousel .item {
    height: 300px;
    }
    .carousel img {
    height: 300px;
    }
    .carousel-caption {
    width: 65%;
    padding: 0 70px;
    margin-bottom: 40px;
    }
    .carousel-caption h1 {
    font-size: 30px;
    }
    .carousel-caption .lead,
    .carousel-caption .btn {
    font-size: 18px;
    }
    }
  </style>
</head>

<body style="padding-top: 50px;">

<div class="container">

<div class="navbar navbar-fixed-top navbar-static">
  <div class="navbar-inner">
    <div class="container">
      <a class="brand" href="index.html">Splout SQL</a>

      <div class="nav-collapse">
        <ul class="nav">
          <li><a href="features.html">Features</a></li>
          <li><a href="philosophy.html">Philosophy</a></li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Technical details <b
                class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="architecture.html">Architecture</a></li>
              <li><a href="performance.html">Performance</a></li>
            </ul>
          </li>
          <li class="dropdown">
            <a href="gettingstarted.html" class="dropdown-toggle" data-toggle="dropdown">Getting started
              <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="gettingstarted.html">Installing & running Splout</a></li>
              <li><a href="gettingstarted.html#loading">Loading an example dataset</a></li>
            </ul>
          </li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">User guide <b
                class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="user_guide.html">HTML</a></li>
              <li><a href="user_guide.pdf">Download as PDF</a></li>
            </ul>
          </li>
          <li><a href="faq.html">F.A.Q.</a></li>
        </ul>
        <ul class="nav pull-right">
          <li class="divider-vertical"></li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contributing <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="https://github.com/datasalt/splout-db/">Source code</a></li>
              <li><a href="#">Continuous integration</a></li>
              <li><a href="#">Code quality</a></li>
              <li><a href="https://groups.google.com/forum/#!forum/sploutdb-dev">Developers group</a>
              </li>
            </ul>
          </li>
          <li class="dropdown">
            <a href="about.html" class="dropdown-toggle" data-toggle="dropdown">About <b
                class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="#">License</a></li>
              <li><a href="#">Team</a></li>
              <li><a href="https://groups.google.com/forum/?fromgroups#!forum/sploutdb-users">Users
                group</a></li>
            </ul>
          </li>
        </ul>
      </div>
      <!-- /.nav-collapse -->
    </div>
  </div>
</div>
<!-- /navbar -->

<div class="page-header">
  <h2 style="align:center;">Getting started with Splout SQL</h2>
</div>

<h3>Installing Splout</h3>

<p>For playing with Splout you will need:</p>

<ul>
  <li>Java >= 1.6</li>
  <li><a href='http://www.apache.org/dyn/closer.cgi/hadoop/common/' target='_blank'>Hadoop stable or
    previous versions of it</a> installed on your machine. HADOOP_HOME must be defined.
  </li>
</ul>

<p>You can <a href='https://github.com/datasalt/splout-db/downloads' target='_blank'>download a release
  of Splout in Github</a>. After that, you just need to decompress it.</p>

<h3 id="running">Running a local cluster</h3>

<p>The best thing for getting started with Splout is launching a local server in your machine:</p>

<pre><tt>bin/splout-service.sh qnode start
  bin/splout-service.sh dnode start
</tt></pre>

<p>Now, if everything went fine, and assuming you had nothing running on port 4412 before, you will see a
  nice panel in <a href='http://localhost:4412' target='_blank'>localhost:4412</a> like this:</p>

<center><img src="img/Panel.png"/></center>

<p>Notice how there is no tablespace loaded in the system. That is expected, we will load an example one
  later. In logs/ folder you will find the logs of both the QNode and the DNode service. You can shutdown
  the services anytime with:</p>

<pre><tt>bin/splout-service.sh qnode stop
  bin/splout-service.sh dnode stop
</tt></pre>

<div class="page-header" id="loading">
  <h2 style="align:center;">Loading an example dataset</h2>
</div>

<p>Splout comes with a few examples, one of which consists of miscellaneous world facts. We will load it
  and play with it to get used to the system and its behavior.</p>

<p>First, upload to HDFS the examples folder, as it contains the input files for all examples.</p>

<pre><tt>hadoop fs -put examples examples
</tt></pre>

<h3>Single Table Loading:</h3>

<p>Load the table city from the CSV file city.csv and use the country_code field to partition it into 4
  partitions:</p>

<pre><tt>hadoop jar splout-*-hadoop.jar simple-generate --input examples/world/city.csv --output
  database-files --tablespace city_pby_country_code --table city --separator , --escape \\ --quotes
  \"\"\" --nullstring \\N --schema
  "id:int,name:string,country_code:string,district:string,population:int" --partitionby country_code
  --partitions 4
</tt></pre>

<p>Finally, deploy the results into Splout, using replication 2. That is, there will be 2 replicas per
  each partition:</p>

<pre><tt>hadoop jar splout-*-hadoop.jar deploy --root database-files --tablespaces city_pby_country_code
  --replication 2 --qnode http://localhost:4412
</tt></pre>

<p>In this particular example, as you have only one dnode, replication will be adjusted automatically to
  1. Look at the panel to see the information of the created tablespace:</p>

<pre><tt><a href='http://localhost:4412/tablespace.html?tablespace=city_pby_country_code'
            target='_blank'>http://localhost:4412/tablespace.html?tablespace=city_pby_country_code</a>
</tt></pre>

<p>Particularly, look at how partitions has been distributed using different country_code ranges. Now,
  you can launch some queries at the query console:</p>

<pre><tt><a href='http://localhost:4412/console.html'
            target='_blank'>http://localhost:4412/console.html</a>
</tt></pre>

<p>Perform the following query to show all the tables in the tablespace:</p>

<table class="table">
  <thead>
  <th>Tablespace</th>
  <th>Partition key</th>
  <th>Query</th>
  </thead>
  <tbody>
  <tr>
    <td>city_pby_country_code</td>
    <td>(empty)</td>
    <td>SELECT * FROM sqlite_master WHERE type='table';</td>
  </tbody>
</table>

<p>Now, let's find the cities with country_code</p>

<table class="table">
  <thead>
  <th>Tablespace</th>
  <th>Partition key</th>
  <th>Query</th>
  </thead>
  <tbody>
  <tr>
    <td>city_pby_country_code</td>
    <td>JPN</td>
    <td>SELECT * FROM city WHERE country_code = "JPN"</td>
  </tbody>
</table>

<p>Note that the shard 2 (partition 2) was hit. That is because we provided "JPN" as partition key.
  Otherwise, a wrong partition would have been hit, and no results would have been presented. Perform a
  test. Repeat the query, but keep the partition key empty. You'll see no results and partition 0 being
  hit.</p>

<p>The former query can be performed just using the REST Splout SQL interface. For the former query the
  URL would be the following:</p>

<pre><tt><a
    href='http://localhost:4412/api/query/city_pby_country_code?key=JPN&sql=SELECT%20*%20FROM%20city%20WHERE%20country_code%20%3D%20%22JPN%22'
    target='_blank'>http://localhost:4412/api/query/city_pby_country_code?key=JPN&sql=SELECT%20*%20FROM%20city%20WHERE%20country_code%20%3D%20%22JPN%22</a>
</tt></pre>

<h3>Multiple Tables:</h3>

<p>Multiple tables per tablespace are allowed. But all of them must be partitioned by the same key. We
  are going to create two different tablespaces:</p>

<br>

<h4>world-pby-country:</h4>

<table class="table">
  <tr>
    <td>country</td>
    <td>partitioned by country</td>
  </tr>
  <tr>
    <td>city</td>
    <td>partitioned by country_code</td>
  </tr>
  <tr>
    <td>country_language</td>
    <td>full table present in all partitions</td>
  </tr>
</table>

<br>

<h4>world-pby-continent-region:</h4>

<table class="table">
  <tr>
    <td>country</td>
    <td>partitioned by continent and region</td>
  </tr>
  <tr>
    <td>country_language</td>
    <td>full table present in all partitions</td>
  </tr>
</table>

<br>

<p>The structure of these tablespaces, and the the specification of the input data are in the files:
  <strong>world-pby-country.json</strong> and <strong>world-pby-continent-region.json</strong></p>

<p>Launch the following command to create both tablespaces:</p>

<pre><tt>hadoop jar splout-*-hadoop.jar generate --output database-files --tablespacefile
  examples/world/world-pby-country.json --tablespacefile examples/world/world-pby-continent-region.json
</tt></pre>

<p>Have a look to the database-files folder:</p>

<pre><tt>hadoop fs -ls database-files
</tt></pre>

<p>At this point, the tablespace files have been created, but they are not still present at Splout SQL.
  We have to deploy them. We can deploy both tablespaces at the same time atomically, so we can be sure
  that information between tablespaces will be consistent. Whichever of the following command performs
  the deploy of the tablespaces.</p>

<pre><tt>hadoop jar splout-*-hadoop.jar deploy -root database-files -ts world-pby-continent-region -ts
  world-pby-country -r 2 -q http://localhost:4412
  hadoop jar splout-*-hadoop.jar deploy --config-file examples/world/deployment.json --qnode
  http://localhost:4412
</tt></pre>

<p>Now both tablespaces should be present at Splout SQL. Have a look to the console.</p>

<br>

<p>You can also check out the following queries:</p>

<br>

<table class="table">
  <thead>
  <th></th>
  <th>Tablespace</th>
  <th>Partition key</th>
  <th>SQL Query</th>
  </thead>
  <tbody>
  <tr>
    <td>All Japan Languages:</td>
    <td>world-pby-country</td>
    <td>JPN</td>
    <td>SELECT country_language.* FROM country, country_language WHERE country.code =
      country_language.country_code AND country.code = "JPN"
    </td>
  </tr>
  <tr>
    <td>Distinct districs in Japan:</td>
    <td>world-pby-country</td>
    <td>JPN</td>
    <td>SELECT country.name, count(distinct district) as num_districts FROM country, city WHERE
      country.code = "JPN" and country.code = city.country_code
    </td>
  </tr>
  <tr>
    <td>Population of Western Europe:</td>
    <td>world-pby-continent-region</td>
    <td>EuropeWestern Europe</td>
    <td>SELECT continent,region,sum(population) total_population FROM country WHERE continent = "Europe"
      AND region = "Western Europe";
    </td>
  </tr>
  <tr>
    <td>Biggest countries on Central Africa:</td>
    <td>world-pby-continent-region</td>
    <td>AfricaCentral Africa</td>
    <td>SELECT name, surface_area FROM country WHERE continent = "Africa" AND region = "Central Africa"
      ORDER BY surface_area DESC;
    </td>
  </tr>
  <tr>
    <td>Most talked languages on Central Africa:</td>
    <td>world-pby-continent-region</td>
    <td>AfricaCentral Africa</td>
    <td>SELECT language, sum((percentage/100)*population) as people FROM country, country_language WHERE
      country.code = country_language.country_code AND continent = "Africa" AND region = "Central Africa"
      GROUP BY language ORDER BY people DESC;
    </td>
  </tr>
  </tbody>
</table>

<br>

<p>Note that all the queries presented before are compatible with the partitioning decided for the
  tablespace. Otherwise they would have not worked properly. Also, be careful to properly define the
  needed indexes in order to answer queries fast.</p>


<br><br><br><br>
<!-- Footer -->
<footer class="footer">
  <p class="pull-right"><a href="http://datasalt.com">Splout is maintained by Datasalt</a></p>
</footer>
</div>
<!-- /container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/bootswatch.js"></script>
</body>
</html>
